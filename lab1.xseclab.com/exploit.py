#coding=utf-8
import requests
from bs4 import BeautifulSoup
import lxml.html

s = requests.Session()
url = 'http://lab1.xseclab.com/xss2_0d557e6d2a4ac08b749b61473a075be1/index.php'

headers = {
	'Host': 'lab1.xseclab.com',
    'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10.12; rv:53.0) Gecko/20100101 Firefox/53.0',
    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
    'Accept-Language': 'zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3',
    'Accept-Encoding': 'gzip, deflate',
    'Connection': 'close',
    'Upgrade-Insecure-Requests': '1',
}

r = s.get(url, headers=headers)
soup = BeautifulSoup(r.content, "lxml")

#  得到BeautifulSoup之后的字符窜
soup_resutlt = soup.find("form").get_text()
#  通过string.split()得到待运算的表达式，并通过eval()得到计算之后的值
cal_result=  eval(soup_resutlt.split('\n')[2].split('=')[0])
print cal_result
# 通过requests将计算后的值发送出去
# 
# 
# 先向headers中加入 Content-Type: application/x-www-form-urlencoded
headers.update({'Content-Type': 'application/x-www-form-urlencoded'})
r1 = s.post(url, headers=headers, data="v={}".format(cal_result))
print r1.content
# 